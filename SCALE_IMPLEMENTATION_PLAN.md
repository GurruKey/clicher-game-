# План внедрения системы масштабирования (Scale-to-Fit)

Этот план описывает переход на систему глобального масштабирования интерфейса, чтобы обеспечить идентичное отображение игры во всех браузерах (Safari, Chrome) и на разных разрешениях экрана.

## 1. Концепция
Мы определяем "эталонное" разрешение (напр. 1920x1080), при котором интерфейс выглядит идеально. Весь UI рендерится внутри контейнера, который масштабируется через `CSS transform: scale()`. Это позволяет сохранить пропорции и расположение элементов независимо от реального размера окна браузера.

## 2. Список файлов для изменения

### Стили (CSS)
- `src/styles/core.css`: 
    - Добавление переменных `--game-scale` и `--vh`.
    - Настройка корневого контейнера `.app` для поддержки масштабирования.
    - Исправление `min-height: 100vh` на использование `--vh`.
- `src/styles/index.css`: Глобальные фиксы для предотвращения размытия шрифтов при масштабировании.
- `src/styles/inventory.css`, `src/styles/avatar.css`, `src/styles/combat.css`: 
    - Замена абсолютных `px` на относительные там, где это критично.
    - Корректировка `position: fixed` на `position: absolute` для элементов внутри масштабируемого контейнера.

### React Компоненты
- `src/App.tsx`: Внедрение хука `useGameScale` и обертывание приложения в масштабируемый контейнер.
- `src/ui/GameScreen.tsx`: Базовая структура игрового экрана, адаптация под масштабирование.
- `src/ui/game/GameOverlays.tsx`: Адаптация отображения драг-иконок и тултипов.

### Хуки (Logic)
- `src/hooks/ui/useGameScale.ts` (НОВЫЙ): Расчет коэффициента масштабирования.
- `src/ui/game/hooks/useGameDragAndDrop.ts`: Корректировка координат `clientX/Y` с учетом коэффициента масштаба.
- `src/hooks/ui/useTooltip.ts`: Корректировка позиционирования тултипа.

## 3. Этапы работы

### Этап 1: Инфраструктура масштабирования
1. Создать хук `useGameScale.ts`, который слушает `resize` окна.
2. Обновить `core.css`, подготовить стили для `.app-scaler`.
3. Модифицировать `App.tsx` для применения трансформации.

### Этап 2: Адаптация интерфейса
1. Пройтись по основным панелям (`CharacterPanel`, `Bag`, `SkillsBar`) и убедиться, что их позиционирование не ломается при изменении масштаба.
2. Внедрить `--vh` для Safari, чтобы нижние элементы не перекрывались системными панелями.

### Этап 3: Исправление интерактивности (Координаты)
1. **Drag & Drop**: Изменить `resolveDropTarget`, чтобы он учитывал масштаб при вызове `elementsFromPoint` (или корректно интерпретировал координаты).
2. **Tooltip**: Пересчитать координаты вывода тултипа, так как теперь он будет находиться внутри масштабированного слоя.

### Этап 4: Полировка
1. Добавление `image-rendering: pixelated` или `crisp-edges` для иконок, если они будут выглядеть мыльно.
2. Настройка `font-smoothing` для Safari/Chrome.

## 4. Как мы проверяем результат
- Открываем игру в Chrome и Safari.
- Уменьшаем/увеличиваем окно браузера. Интерфейс должен пропорционально сжиматься, сохраняя свою структуру, а не "разлетаться".
- Проверяем Drag & Drop: предмет должен падать ровно в ту ячейку, над которой находится курсор.
- Проверяем Tooltip: он должен появляться точно у курсора.

---
**План подготовлен к реализации.**
